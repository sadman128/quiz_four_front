<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Store Dashboard</title>

    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- App CSS -->
    <link rel="stylesheet" href="/style.css">
</head>

<body>

<!-- ================= HEADER ================= -->
<header>
    <div class="logo">Store<span>.</span>Manager</div>
    <nav>
        <a href="#" class="active">Dashboard</a>
    </nav>
    <div class="user-profile">
        <img src="https://ui-avatars.com/api/?name=Store+Admin&background=3498db&color=fff" alt="User">
    </div>
</header>

<!-- ================= STATS ================= -->
<div class="stats-container">

    <div class="stat-card">
        <div class="stat-number" id="statOrders"
             th:text="${dashboard.totalOrder}">
        </div>
        <div class="stat-label">Total Orders Today</div>
    </div>

    <div class="stat-card" style="border-bottom: 4px solid var(--accent-color);">
        <div class="stat-number" id="statRevenue"
             th:text="'$' + ${#numbers.formatDecimal(dashboard.revenue, 1, 'COMMA', 2, 'POINT')}">
        </div>
        <div class="stat-label">Revenue This Month</div>
    </div>

    <div class="stat-card">
        <div class="stat-number" style="color:#f39c12" id="statPending"
             th:text="${dashboard.pendingOrder}">
        </div>
        <div class="stat-label">Pending Orders Today</div>
    </div>

</div>

<!-- ================= MAIN CONTENT ================= -->
<div class="main-content">

    <!-- ===== LEFT: CREATE ORDER ===== -->
    <aside class="form-panel">
        <div class="form-header">Create New Order</div>

        <div class="form-body">
            <div class="form-group">
                <input type="text" id="customerName" class="form-control" placeholder="Customer Name">
            </div>

            <div class="form-group">
                <input type="text" id="productName" class="form-control" placeholder="Product SKU / Name">
            </div>

            <div class="form-group">
                <input type="number" id="orderQty" class="form-control" placeholder="Quantity" value="1" min="1">
            </div>

            <div class="form-group">
                <input type="number" id="orderPrice" class="form-control" placeholder="Total Price ($)" min="0" step="0.01">
            </div>

            <div class="form-group">
                <select id="orderStatus" class="form-control">
                    <option value="Paid">Paid</option>
                    <option value="Pending">Pending</option>
                </select>
            </div>

            <button class="btn-save" id="btnCreateOrder">Create Order</button>
        </div>
    </aside>

    <!-- ===== RIGHT: ORDERS TABLE ===== -->
    <main class="table-panel">

        <div class="table-header-row">
            <div class="section-title">Recent Orders</div>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search orders...">
                <button class="btn-search">Search</button>
            </div>
        </div>

        <div class="table-wrapper">
            <table id="ordersTable">
                <thead>
                <tr>
                    <th>Customer</th>
                    <th>Product Item</th>
                    <th>Quantity</th>
                    <th>Total</th>
                    <th>Status</th>
                    <th>Date & Time</th>
                    <th>Actions</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="order : ${orders}">
                    <td th:text="${order.customer}"></td>
                    <td th:text="${order.product}"></td>
                    <td th:text="${order.quantity}"></td>

                    <td th:text="'$' + ${#numbers.formatDecimal(order.price, 1, 'COMMA', 2, 'POINT')}"></td>

                    <td>
                        <span class="badge"
                              th:text="${order.status}"
                              th:classappend="${order.status == 'Paid'} ? 'badge-completed' : 'badge-pending'">
                        </span>
                    </td>

                    <td th:text="${#dates.format(order.date, 'dd-MM-yyyy')}"></td>


                    <td>
                        <div class="actions">
                            <button class="btn-action btn-edit">
                                <i class="fas fa-pen"></i>
                            </button>
                            <button class="btn-action btn-delete">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

    </main>
</div>

<!-- ================= MODAL ================= -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <span class="modal-title">Edit Order</span>
            <span class="close-modal">&times;</span>
        </div>

        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">Customer Name</label>
                <input type="text" id="editCustomerName" class="form-control">
            </div>

            <div class="form-group">
                <label class="form-label">Product</label>
                <input type="text" id="editProductName" class="form-control">
            </div>

            <div class="form-group">
                <label class="form-label">Quantity</label>
                <input type="number" id="editOrderQty" class="form-control" min="1">
            </div>

            <div class="form-group">
                <label class="form-label">Total Price ($)</label>
                <input type="number" id="editOrderPrice" class="form-control" min="0" step="0.01">
            </div>

            <div class="form-group">
                <label class="form-label">Status</label>
                <select id="editOrderStatus" class="form-control">
                    <option value="Paid">Paid</option>
                    <option value="Pending">Pending</option>
                </select>
            </div>
        </div>

        <div class="modal-footer">
            <button class="btn-cancel" id="btnCancelEdit">Cancel</button>
            <button class="btn-update" id="btnUpdateOrder">Update Order</button>
        </div>
    </div>
</div>

<!-- ================= TOAST ================= -->
<div id="toastContainer" class="toast-container"></div>

<!-- ================= JS ================= -->
<script>
    document.addEventListener('DOMContentLoaded', () => {

        const tableBody = document.querySelector('#ordersTable tbody');

        // ===== MODAL ELEMENTS =====
        const modal = document.getElementById('editModal');
        const btnCloseModal = document.querySelector('.close-modal');
        const btnCancelEdit = document.getElementById('btnCancelEdit');
        const btnUpdateOrder = document.getElementById('btnUpdateOrder');

        let currentEditRow = null;

        // ===== TABLE ACTIONS (EDIT / DELETE) =====
        tableBody.addEventListener('click', (e) => {

            // DELETE
            const btnDelete = e.target.closest('.btn-delete');
            if (btnDelete) {
                const row = btnDelete.closest('tr');
                row.remove();
                return;
            }

            // EDIT
            const btnEdit = e.target.closest('.btn-edit');
            if (btnEdit) {
                currentEditRow = btnEdit.closest('tr');
                openEditModal(currentEditRow);
            }
        });

        // ===== OPEN MODAL =====
        function openEditModal(row) {
            document.getElementById('editCustomerName').value = row.cells[0].innerText;
            document.getElementById('editProductName').value = row.cells[1].innerText;
            document.getElementById('editOrderQty').value = row.cells[2].innerText;

            const price = row.cells[3].innerText.replace(/[^0-9.-]+/g, "");
            document.getElementById('editOrderPrice').value = price;

            document.getElementById('editOrderStatus').value =
                row.cells[4].innerText.trim();

            modal.classList.add('show');
        }

        // ===== CLOSE MODAL =====
        function closeModal() {
            modal.classList.remove('show');
            currentEditRow = null;
        }

        btnCloseModal.addEventListener('click', closeModal);
        btnCancelEdit.addEventListener('click', closeModal);

        window.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });

        // ===== UPDATE ROW =====
        btnUpdateOrder.addEventListener('click', () => {
            if (!currentEditRow) return;

            currentEditRow.cells[0].innerText =
                document.getElementById('editCustomerName').value;

            currentEditRow.cells[1].innerText =
                document.getElementById('editProductName').value;

            currentEditRow.cells[2].innerText =
                document.getElementById('editOrderQty').value;

            const price = parseFloat(document.getElementById('editOrderPrice').value);
            currentEditRow.cells[3].innerText =
                '$' + price.toFixed(2);

            const status = document.getElementById('editOrderStatus').value;
            const badgeClass = status === 'Paid' ? 'badge-completed' : 'badge-pending';

            currentEditRow.cells[4].innerHTML =
                `<span class="badge ${badgeClass}">${status}</span>`;

            closeModal();
        });

    });
</script>


</body>
</html>
